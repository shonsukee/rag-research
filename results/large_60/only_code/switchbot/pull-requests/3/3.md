# LLM Response
```ruby
module Switchbot
	class Client
	  API_ENDPOINT = 'https://api.switch-bot.com'
  
	  def initialize(token, secret)
		@token = token
		@secret = secret
	  end
  
	  def devices
		request(
		  http_method: :get,
		  endpoint: 'v1.1/devices'
		)
	  end

	  def device(device_id)
		Device.new(client: self, device_id: device_id)
	  end

	  def status(device_id:)
		request(
		  http_method: :get,
		  endpoint: "/v1.1/devices/#{device_id}/status"
		)
	  end
  
	  def commands(device_id:, command:, parameter: 'default', command_type: 'command')
		request(
		  http_method: :post,
		  endpoint: "/v1.1/devices/#{device_id}/commands",
		  params: {
			command: command,
			parameter: parameter,
			commandType: command_type
		  }
		)
	  end

	  def scenes
		request(
		  http_method: :get,
		  endpoint: 'v1.1/scenes'
		)
	  end

	  def scene(scene_id)
		Scene.new(client: self, scene_id: scene_id)
	  end

	  def execute(scene_id:)
		request(
		  http_method: :post,
		  endpoint: "/v1.1/scenes/#{scene_id}/execute"
		)
	  end

	  private
  
	  def headers
		timestamp = (Time.now.to_f * 1000).to_i.to_s
		nonce     = SecureRandom.uuid
		data      = @token + timestamp + nonce
		sign      = Base64.strict_encode64(OpenSSL::HMAC.digest('sha256', @secret, data))

		{
		  'User-Agent'   => "Switchbot v#{Switchbot::VERSION} (https://github.com/ytkg/switchbot)",
		  'Content-Type' => 'application/json',
		  'Authorization'=> @token,
		  'sign'         => sign,
		  'nonce'        => nonce,
		  't'            => timestamp
		}
	  end

	  def request(http_method:, endpoint:, params: {})
		response = connection.public_send(http_method, endpoint, params)
		response.body.deep_transform_keys(&:underscore).deep_symbolize_keys
	  end
	end
end
```

# User Query
## Instruction
You are a software engineer specializing in REST APIs.
Please follow the guidelines below to make the necessary modifications.

### Modification Procedure
1. Analyze the deprecated specifications based on `### Technical Specifications for deprecated code`.
2. Based on the analysis in step 1., identify code snippets that follow deprecated specifications within the source code in `## Input Code`.
3. Analyze the latest specifications based on `### Technical Specifications for latest code`.
4. Modify the code snippets identified in step 2. to follow the latest specifications analyzed in step 3., while paying attention to the points listed in `### Attention` below.

### Attention
There may be multiple code snippets following deprecated specifications within `## Input Code`.
Only refer to the information in `### Technical Specifications for Latest code` when making modifications.
Do not perform refactoring or add comments; only modify the parts of the code that follow deprecated specifications to conform to the latest specifications.
Copy the source code from `## Input Code` before making modifications.
Delete all parts only according to the deprecated specification and modify the code to conform to the latest specification.
Only modify the parts of the code that follow deprecated specifications.
If no deprecated specification is found in the source code of the `## Input Code`, compare the source code with the latest specification to identify any differences. If modifications are required, modify the source code according to the latest specification.
Make sure to modify all code that follows deprecated specifications.
After modifications, ensure that all code following deprecated specifications has been replaced with code that conforms to the latest specifications.
If multiple deprecated specifications are present within `## Input Code`, confirm that all are unified under the latest specifications.

## Technical Specifications for deprecated code
```
【Context No.1】
[similarity: 0.671487689]
https://api.switch-bot.com

【Context No.2】
[similarity: 0.628594279]
GET https://api.switch-bot.com/v1.0/devices

【Context No.3】
[similarity: 0.574751556]
POST https://api.switch-bot.com/v1.0/devices/84F70353A411/commands

【Context No.4】
[similarity: 0.566144526]
POST https://api.switch-bot.com/v1.0/devices/210/commands

【Context No.5】
[similarity: 0.56140089]
POST https://api.switch-bot.com/v1.0/devices/02-202007201626-10/commands

【Context No.6】
[similarity: 0.558809221]
POST https://api.switch-bot.com/v1.0/devices/02-202007201626-70/commands

【Context No.7】
[similarity: 0.553980231]
GET https://api.switch-bot.com/v1.0/scenes

【Context No.8】
[similarity: 0.545163929]
GET https://api.switch-bot.com/v1.0/devices/E2F6032048AB/status

【Context No.9】
[similarity: 0.542767882]
GET https://api.switch-bot.com/v1.0/devices/C271111EC0AB/status

【Context No.10】
[similarity: 0.504270196]
POST https://api.switch-bot.com/v1.0/scenes/T02-202009221414-48924101/execute

【Context No.11】
[similarity: 0.471466452]
POST https://api.switch-bot.com/v1.0/webhook/queryWebhook

【Context No.12】
[similarity: 0.449054629]
POST https://api.switch-bot.com/v1.0/webhook/setupWebhook

【Context No.13】
[similarity: 0.415827245]
POST https://api.switch-bot.com/v1.0/webhook/deleteWebhook

【Context No.14】
[similarity: 0.379971027]
GET /v1.0/devices

【Context No.15】
[similarity: 0.327585876]
{
    "statusCode": 100,
    "body": {
        "deviceList": [
            {
                "deviceId": "500291B269BE",
                "deviceName": "Living Room Humidifier",
                "deviceType": "Humidifier",
                "enableCloudService": true,
                "hubDeviceId": "000000000000"
            }
        ],
        "infraredRemoteList": [
            {
                "deviceId": "02-202008110034-13",
                "deviceName": "Living Room TV",
                "remoteType": "TV",
                "hubDeviceId": "FA7310762361"
            }
        ]
    },
    "message": "success"
}

【Context No.16】
[similarity: 0.323846936]
GET /v1.0/devices/{deviceId}/status

【Context No.17】
[similarity: 0.322991818]
POST /v1.0/devices/{deviceId}/commands

【Context No.18】
[similarity: 0.319180876]
{
    "statusCode": 100,
    "body": [
        {
            "sceneId": "T02-20200804130110",
            "sceneName": "Close Office Devices"
        },
        {
            "sceneId": "T02-202009221414-48924101",
            "sceneName": "Set Office AC to 25"
        },
        {
            "sceneId": "T02-202011051830-39363561",
            "sceneName": "Set Bedroom to 24"
        },
        {
            "sceneId": "T02-202011051831-82928991",
            "sceneName": "Turn off home devices"
        },
        {
            "sceneId": "T02-202011062059-26364981",
            "sceneName": "Set Bedroom to 26 degree"
        }
    ],
    "message": "success"
}

【Context No.19】
[similarity: 0.310471296]
{
    "Content-type":"application/json",
    "Authorization":your_token // enter your API token
}

【Context No.20】
[similarity: 0.305881053]
GET /v1.0/scenes

【Context No.21】
[similarity: 0.304975599]
{
    "statusCode": 100,
    "body": {
        "deviceId": "E2F6032048AB",
        "deviceType": "Curtain",
        "hubDeviceId": "FA7310762361",
        "calibrate": true,
        "group": false,
        "moving": false,
        "slidePosition": 0
    },
    "message": "success"
}

【Context No.22】
[similarity: 0.295946419]
{
    "action":"setupWebhook",
    "url":url1, // enter your url
    "deviceList":"ALL"
}

【Context No.23】
[similarity: 0.288496166]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoPlugJP",
        "deviceMac": DEVICE_MAC_ADDR,
        "powerState": "ON",
        "timeOfSample": 123456789
    }
}

【Context No.24】
[similarity: 0.287144631]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoBulb",
        "deviceMac": DEVICE_MAC_ADDR,
        "powerState": "ON",
        "brightness": 10,
        "color":"255:245:235",
        "colorTemperature":3500,
        "timeOfSample": 123456789
    }
}

【Context No.25】
[similarity: 0.281427354]
{
    "statusCode": 100,
    "body": {
        "deviceId": "C271111EC0AB",
        "deviceType": "Meter",
        "hubDeviceId": "FA7310762361",
        "humidity": 52,
        "temperature": 26.1
    },
    "message": "success"
}

【Context No.26】
[similarity: 0.28014037]
{
    "statusCode": 100,
    "body": [
        {
            "url":url1,
            "createTime":123456,
            "lastUpdateTime":123456,
            "deviceList": "ALL",
            "enable":true
        }
    ],
    "message": ""
}

【Context No.27】
[similarity: 0.27428028]
{
    "command": "turnOn",
    "parameter": "default",
    "commandType": "command"
}

【Context No.28】
[similarity: 0.27041015]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoStrip",
        "deviceMac": DEVICE_MAC_ADDR,
        "powerState": "ON",
        "brightness": 10,
        "color": "255:245:235",
        "timeOfSample": 123456789
    }
}

【Context No.29】
[similarity: 0.270312816]
POST /v1.0/scenes/{sceneId}/execute

【Context No.30】
[similarity: 0.266886622]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoPlugUS",
        "deviceMac": DEVICE_MAC_ADDR,
        "powerState": "ON",
        "timeOfSample": 123456789
    }
}

【Context No.31】
[similarity: 0.262224764]
{
    "command": "ボタン", // the name of the customized button
    "parameter": "default",
    "commandType": "customize"
}

【Context No.32】
[similarity: 0.253482252]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoContact",
        "deviceMac": DEVICE_MAC_ADDR,
        "detectionState": "NOT_DETECTED",
        "doorMode":"OUT_DOOR",
        "brightness": "dim",
        "openState": "open",
        "timeOfSample": 123456789
    }
}

【Context No.33】
[similarity: 0.249259084]
{
    "action": "updateWebhook",
    "config":{
        "url":url1,
        "enable":true
    }
}

【Context No.34】
[similarity: 0.242852986]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoPanTiltCam",
        "deviceMac": DEVICE_MAC_ADDR,
        "detectionState": "DETECTED",
        "timeOfSample": 123456789
    }
}

【Context No.35】
[similarity: 0.242618397]
{
    "statusCode": 100,
    "body": {},
    "message": ""
}

【Context No.36】
[similarity: 0.239336967]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoMeter",
        "deviceMac": DEVICE_MAC_ADDR,
        "temperature": 22.5,
        "scale": "CELSIUS",
        "humidity": 31,
        "timeOfSample": 123456789
    }
}

【Context No.37】
[similarity: 0.238894686]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoCamera",
        "deviceMac": DEVICE_MAC_ADDR,
        "detectionState": "DETECTED",
        "timeOfSample": 123456789
    }
}

【Context No.38】
[similarity: 0.238775447]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoLock",
        "deviceMac": DEVICE_MAC_ADDR,
        "lockState": "LOCKED",
        "timeOfSample": 123456789
    }
}

【Context No.39】
[similarity: 0.23198992]
{
    "command": "setColor",
    "parameter": "122:80:20", // yellow
    "commandType": "command"
}

【Context No.40】
[similarity: 0.231403455]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoPresence",
        "deviceMac": DEVICE_MAC_ADDR,
        "detectionState": "NOT_DETECTED",
        "timeOfSample": 123456789
    }
}

【Context No.41】
[similarity: 0.227960393]
{
    "action": "deleteWebhook",
    "url":url1
}

【Context No.42】
[similarity: 0.22793521]
{
    "statusCode": 100,
    "body": {},
    "message": "success"
}

【Context No.43】
[similarity: 0.220036313]
{
    "statusCode": 100,
    "body": {},
    "message": "success"
}

【Context No.44】
[similarity: 0.219669342]
{
    "statusCode": 100,
    "body": {
        "urls": [url1] // the target url
    },
    "message": ""
}

【Context No.45】
[similarity: 0.191082463]
{
    "command": "setAll",
    "parameter": "26,1,3,on",
    "commandType": "command"
}

【Context No.46】
[similarity: 0.162215427]
{
    "action": "queryDetails",
    "urls":[url1] // get infos of a url
}

【Context No.47】
[similarity: 0.152160957]
{
    "action": "queryUrl"
}
```

## Input Code
```
module Switchbot
	class Client
	  API_ENDPOINT = 'https://api.switch-bot.com'
  
	  def initialize(token)
		@token = token
	  end
  
	  def devices
		request(
		  http_method: :get,
		  endpoint: 'v1.0/devices'
		)
	  end

	  def device(device_id)
		Device.new(client: self, device_id: device_id)
	  end
	  def status(device_id:)
		request(
		  http_method: :get,
		  endpoint: "/v1.0/devices/#{device_id}/status"
		)
	  end
  
	  def commands(device_id:, command:, parameter: 'default', command_type: 'command')
		request(
		  http_method: :post,
		  endpoint: "/v1.0/devices/#{device_id}/commands",
		  params: {
			command: command,
			parameter: parameter,
			commandType: command_type
		  }
		)
	  end
	  def scenes
		request(
		  http_method: :get,
		  endpoint: 'v1.0/scenes'
		)
	  end

	  def scene(scene_id)
		Scene.new(client: self, scene_id: scene_id)
	  end
	  def execute(scene_id:)
		request(
		  http_method: :post,
		  endpoint: "/v1.0/scenes/#{scene_id}/execute"
		)
	  end

	  private
  
	  def headers
		{
		  'User-Agent' => "Switchbot v#{Switchbot::VERSION} (https://github.com/ytkg/switchbot)",
		  'Authorization' => @token
		}
	  end

	  def request(http_method:, endpoint:, params: {})
		response = connection.public_send(http_method, endpoint, params)
		response.body.deep_transform_keys(&:underscore).deep_symbolize_keys
	  end
	end
end

```

## Technical Specifications for latest code
```
【Context No.1】
[similarity: 0.671493351]
https://api.switch-bot.com

【Context No.2】
[similarity: 0.627852678]
GET https://api.switch-bot.com/v1.1/devices

【Context No.3】
[similarity: 0.606483877]
using System;
using System.Diagnostics;
using System.Text;
using System.Security.Cryptography;
using System.Net.Http;

string token = "My Token";
string secret = "My Secret Key";
DateTime dt1970 = new DateTime(1970, 1, 1);
DateTime current = DateTime.Now;
TimeSpan span = current - dt1970;
long time = Convert.ToInt64(span.TotalMilliseconds);
string nonce = Guid.NewGuid().ToString();
string data = token + time.ToString() + nonce;
Encoding utf8 = Encoding.UTF8;
HMACSHA256 hmac = new HMACSHA256(utf8.GetBytes(secret));
string signature = Convert.ToBase64String(hmac.ComputeHash(utf8.GetBytes(data)));

//Create http client
HttpClient client = new HttpClient();
var request = new HttpRequestMessage(HttpMethod.Get, @"https://api.switch-bot.com/v1.1/devices");
request.Headers.TryAddWithoutValidation(@"Authorization", token);
request.Headers.TryAddWithoutValidation(@"sign", signature);
request.Headers.TryAddWithoutValidation(@"nonce", nonce);
request.Headers.TryAddWithoutValidation(@"t", time.ToString());

var response = await client.SendAsync(request);

Console.WriteLine(await response.Content.ReadAsStringAsync());

【Context No.4】
[similarity: 0.573162854]
POST https://api.switch-bot.com/v1.1/devices/84F70353A411/commands

【Context No.5】
[similarity: 0.57152]
<?php
$token = 'XXXXXXXXXXXXXXXXXXX';
$secret = 'YYYYYYYYYYY';
$nonce = guidv4();
$t = time() * 1000;
$data = utf8_encode($token . $t . $nonce);
$sign = hash_hmac('sha256', $data, $secret,true);
$sign = strtoupper(base64_encode($sign));

$url = "https://api.switch-bot.com/v1.1/devices";

$curl = curl_init($url);
curl_setopt($curl, CURLOPT_URL, $url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);

$headers = array(
    "Content-Type:application/json",
    "Authorization:" . $token,
    "sign:" . $sign,
    "nonce:" . $nonce,
    "t:" . $t
);

curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);
$response = curl_exec($curl);
curl_close($curl);

function guidv4($data = null) {
    // Generate 16 bytes (128 bits) of random data or use the data passed into the function.
    $data = $data ?? random_bytes(16);
    assert(strlen($data) == 16);
    $data[6] = chr(ord($data[6]) & 0x0f | 0x40);
    $data[8] = chr(ord($data[8]) & 0x3f | 0x80);

    // Output the 36 character UUID.
    return vsprintf('%s%s-%s-%s-%s-%s%s%s', str_split(bin2hex($data), 4));
}

【Context No.6】
[similarity: 0.568089187]
POST https://api.switch-bot.com/v1.1/devices/F7538E1ABCEB/commands

【Context No.7】
[similarity: 0.566370249]
POST https://api.switch-bot.com/v1.1/devices/210/commands

【Context No.8】
[similarity: 0.564132631]
POST https://api.switch-bot.com/v1.1/devices/F7538E1ABC23/commands

【Context No.9】
[similarity: 0.563721836]
import json
import time
import hashlib
import hmac
import base64
import uuid

# Declare empty header dictionary
apiHeader = {}
# open token
token = '' # copy and paste from the SwitchBot app V6.14 or later
# secret key
secret = '' # copy and paste from the SwitchBot app V6.14 or later
nonce = uuid.uuid4()
t = int(round(time.time() * 1000))
string_to_sign = '{}{}{}'.format(token, t, nonce)

string_to_sign = bytes(string_to_sign, 'utf-8')
secret = bytes(secret, 'utf-8')

sign = base64.b64encode(hmac.new(secret, msg=string_to_sign, digestmod=hashlib.sha256).digest())
print ('Authorization: {}'.format(token))
print ('t: {}'.format(t))
print ('sign: {}'.format(str(sign, 'utf-8')))
print ('nonce: {}'.format(nonce))

#Build api header JSON
apiHeader['Authorization']=token
apiHeader['Content-Type']='application/json'
apiHeader['charset']='utf8'
apiHeader['t']=str(t)
apiHeader['sign']=str(sign, 'utf-8')
apiHeader['nonce']=str(nonce)

【Context No.10】
[similarity: 0.563648283]
package main

import (
    "crypto/hmac"
    "crypto/sha256"
    "encoding/base64"
    "fmt"
    "io"
    "log"
    "net/http"
    "strings"
    "time"
)

func main() {
    token := "XXXXXXXXXXXXXXXXXXX"      // copy and paste from the SwitchBot app V6.14 or later
    secret := "YYYYYYYYYYY"             // copy and paste from the SwitchBot app V6.14 or later
    nonce := UUID()                     // generate random UUID v4
    timestamp := time.Now().UnixMilli() // 13-digit milliseconds Unix timestamp

    data := fmt.Sprintf("%s%d%s", token, timestamp, nonce)

    mac := hmac.New(sha256.New, []byte(secret))
    if _, err := mac.Write([]byte(data)); err != nil {
        log.Fatalf("Error generating signature: %v", err)
    }

    signature := mac.Sum(nil)
    signatureB64 := strings.ToUpper(base64.StdEncoding.EncodeToString(signature))

    url := "https://api.switch-bot.com/v1.1/devices"
    req, err := http.NewRequest("GET", url, nil)
    if err != nil {
        log.Fatalf("Error creating request: %v", err)
    }

    req.Header.Set("Content-Type", "application/json")
    req.Header.Set("Authorization", token)
    req.Header.Set("sign", signatureB64)
    req.Header.Set("nonce", nonce)
    req.Header.Set("t", fmt.Sprintf("%d", timestamp))

    client := &http.Client{}
    resp, err := client.Do(req)
    if err != nil {
        log.Fatalf("Error sending request: %v", err)
    }
    defer resp.Body.Close()

    body, err := io.ReadAll(resp.Body)
    if err != nil {
        log.Fatalf("Error reading response: %v", err)
    }

    fmt.Println(string(body)) // Response in JSON format
}

// UUID returns an RFC 4122/9562–compliant random UUIDv4 string.
func UUID() string {
    var uuid [16]byte                 // 128-bit long array
    rand.Read(uuid[:])                // Use cryptographically secure random source
    uuid[6] = (uuid[6] & 0x0F) | 0x40 // Version (UUIDv4 = 0100)
    uuid[8] = (uuid[8] & 0x3F) | 0x80 // Variant (RFC9562 / RFC4122 = 10xxxxxx)

    return fmt.Sprintf("%08x-%04x-%04x-%04x-%012x",
        uuid[0:4],  // 4 bytes
        uuid[4:6],  // 2 bytes
        uuid[6:8],  // 2 bytes (version included)
        uuid[8:10], // 2 bytes (variant included)
        uuid[10:])  // 6 bytes
}

【Context No.11】
[similarity: 0.561298311]
POST https://api.switch-bot.com/v1.1/devices/02-202007201626-10/commands

【Context No.12】
[similarity: 0.559401155]
POST https://api.switch-bot.com/v1.1/devices/02-202007201626-70/commands

【Context No.13】
[similarity: 0.557980418]
const crypto = require('crypto');
const https = require('https');

const token = "yourToken";
const secret = "yourSecret";
const t = Date.now();
const nonce = "requestID";
const data = token + t + nonce;
const sign = crypto
    .createHmac('sha256', secret)
    .update(data)
    .digest('base64');
console.log(sign);

const body = JSON.stringify({
    "command": "turnOn",
    "parameter": "default",
    "commandType": "command"
});
const deviceId = "MAC";
const options = {
    hostname: 'api.switch-bot.com',
    port: 443,
    path: `/v1.1/devices/${deviceId}/commands`,
    method: 'POST',
    headers: {
        "Authorization": token,
        "sign": sign,
        "nonce": nonce,
        "t": t,
        'Content-Type': 'application/json',
        'Content-Length': body.length,
    },
};

const req = https.request(options, res => {
    console.log(`statusCode: ${res.statusCode}`);
    res.on('data', d => {
        process.stdout.write(d);
    });
});

req.on('error', error => {
    console.error(error);
});

req.write(body);
req.end();

【Context No.14】
[similarity: 0.555568814]
GET https://api.switch-bot.com/v1.1/scenes

【Context No.15】
[similarity: 0.548637152]
GET https://api.switch-bot.com/v1.1/devices/E2F6032048AB/status

【Context No.16】
[similarity: 0.547251523]
GET https://api.switch-bot.com/v1.1/devices/C271111EC0AB/status

【Context No.17】
[similarity: 0.545559883]
import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.net.http.HttpResponse.BodyHandlers;
import java.time.Instant;
import java.util.Base64;
import java.util.UUID;

import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

public class Main {
    public static void main(String[] args) throws Exception {
    	
      String token = args[0];
      String secret = args[1];
      String nonce = UUID.randomUUID().toString();
      String time= "" + Instant.now().toEpochMilli();
      String data = token + time + nonce;
      
      SecretKeySpec secretKeySpec = new SecretKeySpec(secret.getBytes("UTF-8"), "HmacSHA256");
      Mac mac = Mac.getInstance("HmacSHA256");
      mac.init(secretKeySpec);
      String signature = new String(Base64.getEncoder().encode(mac.doFinal(data.getBytes("UTF-8"))));      
      
      HttpRequest getDevices = HttpRequest.newBuilder()
      .uri(new URI("https://api.switch-bot.com/v1.1/devices"))
      .header("Authorization", token)
      .header("sign", signature)
      .header("nonce", nonce)
      .header("t", time)
      .GET()
      .build();
      
      HttpResponse<String> response = HttpClient.newBuilder().build().send(getDevices, BodyHandlers.ofString());
      
      System.out.println(response.body());
    }
}

【Context No.18】
[similarity: 0.544877291]
import CryptoKit 

let token = 'TTTTTTT'
let secret = 'SSSS'

func getDevices() async throws -> Any {
    let hostname = "https://api.switch-bot.com"
    
    var components = URLComponents(string: hostname)!
    components.path = "/v1.1/devices"
    components.port = 443
    
    var request = URLRequest(url: components.url!)
    
    request.setValue("application/json", forHTTPHeaderField: "Content-Type")
    request.setValue("utf-8", forHTTPHeaderField: "charset")
    let timestamp = Int(Date().timeIntervalSince1970.rounded() * 1000) // Date().timeInterval returns seconds, not milliseconds, since1970
    let nonce =  UUID().uuidString
    
    let timeAdjustedToken = token + "\(timestamp)" + nonce
    let key = SymmetricKey(data: Data(secret.utf8))
    let authenticationCode = HMAC<SHA256>.authenticationCode(for: Data(timeAdjustedToken.utf8), using: key)
    let signatureToken = Data(authenticationCode).base64EncodedString()

    request.setValue(token, forHTTPHeaderField: "Authorization")
    request.setValue(signatureToken, forHTTPHeaderField: "sign")
    request.setValue(nonce, forHTTPHeaderField: "nonce")
    request.setValue("\(timestamp)", forHTTPHeaderField: "t")
    
    let (data, response) = try await URLSession.shared.data(for: request)
    return try JSONSerialization.jsonObject(with: data)
}

【Context No.19】
[similarity: 0.51997751]
# secret key
secret = "" # copy and paste from the SwitchBot app V6.14 or later
# open token
token = "" # copy and paste from the SwitchBot app V6.14 or later
t = 1661927531000
sign = HMAC-SHA256(token + t, secret).toUpperCase()

【Context No.20】
[similarity: 0.513265133]
import time
import hashlib
import hmac
import base64

# open token
token = '' # copy and paste from the SwitchBot app V6.14 or later
# secret key
secret = '' # copy and paste from the SwitchBot app V6.14 or later
nonce = ''
t = int(round(time.time() * 1000))
string_to_sign = '{}{}{}'.format(token, t, nonce)

sign = base64.b64encode(hmac.new(secret, msg=string_to_sign, digestmod=hashlib.sha256).digest())
print ('Authorization: {}'.format(token))
print ('t: {}'.format(t))
print ('sign: {}'.format(sign))
print ('nonce: {}'.format(nonce))

【Context No.21】
[similarity: 0.505854368]
POST https://api.switch-bot.com/v1.1/scenes/T02-202009221414-48924101/execute

【Context No.22】
[similarity: 0.469851941]
POST https://api.switch-bot.com/v1.1/webhook/queryWebhook

【Context No.23】
[similarity: 0.447357088]
POST https://api.switch-bot.com/v1.1/webhook/setupWebhook

【Context No.24】
[similarity: 0.444410861]
POST https://api.switch-bot.com/v1.1/webhook/updateWebhook

【Context No.25】
[similarity: 0.416009724]
POST https://api.switch-bot.com/v1.1/webhook/deleteWebhook

【Context No.26】
[similarity: 0.378564388]
GET /v1.1/devices

【Context No.27】
[similarity: 0.332770407]
GET /v1.1/devices/{deviceId}/status

【Context No.28】
[similarity: 0.327294052]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Robot Vacuum Cleaner s20",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        "onlineStatus": "online",
        "battery": 100,// 0-100
        "waterBaseBattery": 100,
        "taskType": "explore",
        "timeOfSample": 123456789
    }
}

【Context No.29】
[similarity: 0.327220887]
POST /v1.1/devices/{deviceId}/commands

【Context No.30】
[similarity: 0.323656797]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Robot Vacuum Cleaner S10",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        "onlineStatus": "online",
        "battery": 100,// 0-100
        "waterBaseBattery": 100,
        "taskType": "explore",
        "timeOfSample": 123456789
    }
}

【Context No.31】
[similarity: 0.319945067]
{
    "statusCode": 100,
    "body": [
        {
            "sceneId": "T02-20200804130110",
            "sceneName": "Close Office Devices"
        },
        {
            "sceneId": "T02-202009221414-48924101",
            "sceneName": "Set Office AC to 25"
        },
        {
            "sceneId": "T02-202011051830-39363561",
            "sceneName": "Set Bedroom to 24"
        },
        {
            "sceneId": "T02-202011051831-82928991",
            "sceneName": "Turn off home devices"
        },
        {
            "sceneId": "T02-202011062059-26364981",
            "sceneName": "Set Bedroom to 26 degree"
        }
    ],
    "message": "success"
}

【Context No.32】
[similarity: 0.316296667]
{
    "statusCode": 100,
    "body": {
        "deviceList": [
            {
                "deviceId": "500291B269BE",
                "deviceName": "Living Room Humidifier",
                "deviceType": "Humidifier",
                "enableCloudService": true,
                "hubDeviceId": "000000000000"
            }
        ],
        "infraredRemoteList": [
            {
                "deviceId": "02-202008110034-13",
                "deviceName": "Living Room TV",
                "remoteType": "TV",
                "hubDeviceId": "FA7310762361"
            }
        ]
    },
    "message": "success"
}

【Context No.33】
[similarity: 0.310570925]
{
    "Content-type":"application/json",
    "Authorization":your_token // enter your API token
}

【Context No.34】
[similarity: 0.309421122]
GET /v1.1/scenes

【Context No.35】
[similarity: 0.30602181]
{
    "statusCode": 100,
    "body": {
        "deviceId": "E2F6032048AB",
        "deviceType": "Curtain",
        "hubDeviceId": "FA7310762361",
        "calibrate": true,
        "group": false,
        "moving": false,
        "slidePosition": 0
    },
    "message": "success"
}

【Context No.36】
[similarity: 0.30482173]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Robot Vacuum Cleaner K20+ Pro",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        //StandBy,Clearing,Paused,GotoChargeBase,Charging,ChargeDone,Dormant,InTrouble,InRemoteControl,InDustCollecting
        "onlineStatus": "online",//online,offline
        "battery": 100,// 0-100
        "taskType": "explore", // standBy,explore,cleanAll,cleanArea,cleanRoom,deepWashing,backToCharge,drying,collectDust,remoteControl,cleanWithExplorer
        "timeOfSample": 123456789
    }
}

【Context No.37】
[similarity: 0.303454727]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Robot Vacuum Cleaner K10+ Pro Combo",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        "onlineStatus": "online",
        "battery": 100,
        "taskType": "explore",
        "timeOfSample": 123456789
    }
}

【Context No.38】
[similarity: 0.302355438]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Relay Switch 2PM",
        "deviceMac": "FFFFFFFFFFF",
        "online": false,
        "overTemperature": true,
        "switch1Status": 1,
        "switch2Status": 1,
        "switch1Overload": true,
        "switch2Overload": true,
        "calibrate": true,
        "position": 0,
        "isStuck": true
    }
}

【Context No.39】
[similarity: 0.296981871]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Relay Switch 1",
        "deviceMac": DEVICE_MAC_ADDR,
        "online": false,
        "overTemperature": true,
        "switchStatus": 1,
        "timeOfSample": 123456789
    }
}

【Context No.40】
[similarity: 0.295822114]
{
    "action":"setupWebhook",
    "url":url1, // enter your url
    "deviceList":"ALL"
}

【Context No.41】
[similarity: 0.292555302]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Relay Switch 1PM",
        "deviceMac": DEVICE_MAC_ADDR,
        "online": false,
        "overTemperature": true,
        "overload": true,
        "switchStatus": 1,
        "timeOfSample": 123456789
    }
}

【Context No.42】
[similarity: 0.292424947]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoFan2",
        "deviceMac": DEVICE_MAC_ADDR,
        "mode": "direct",
        "version": "V3.1",
        "battery": 22,
        "powerState": "ON",
        "nightStatus": "off",
        "oscillation": "on",
        "verticalOscillation": "on",
        "chargingStatus": "charging",
        "fanSpeed": 3,
        "timeOfSample": 123456789
    }
}

【Context No.43】
[similarity: 0.291166604]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoRollerShade",
        "deviceMac": DEVICE_MAC_ADDR,
        "calibrate":false,
        "slidePosition":50, //0~100
        "battery":100,
        "timeOfSample": 123456789
    }
}

【Context No.44】
[similarity: 0.290479362]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoSweeperMini",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        "onlineStatus": "online",
        "battery": 100,
        "timeOfSample": 123456789
    }
}

【Context No.45】
[similarity: 0.288857]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoSweeperMiniPro",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        "onlineStatus": "online",
        "battery": 100,
        "timeOfSample": 123456789
    }
}

【Context No.46】
[similarity: 0.288627803]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoPlugJP",
        "deviceMac": DEVICE_MAC_ADDR,
        "powerState": "ON",
        "timeOfSample": 123456789
    }
}

【Context No.47】
[similarity: 0.287639946]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoBulb",
        "deviceMac": DEVICE_MAC_ADDR,
        "powerState": "ON",
        "brightness": 10,
        "color":"255:245:235",
        "colorTemperature":3500,
        "timeOfSample": 123456789
    }
}

【Context No.48】
[similarity: 0.286497]
{
    "commandType": "command",
    "command": "startClean", // start cleaning
    "parameter": {
        "action": "sweep", // clean with vacuum mode
        "param": {
            "fanLevel": 1, // vacuum level set to 1
            "waterLevel": 1, // mop moisture level set to 1
            "times": 1 // number of cyclyes to clean set to 1
        }
    }
}

【Context No.49】
[similarity: 0.284776092]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoFan2",
        "deviceMac": DEVICE_MAC_ADDR,
        "mode": "direct",
        "version": "V3.1",
        "powerState": "ON",
        "nightStatus": "off",
        "oscillation": "on",
        "verticalOscillation": "on",
        "fanSpeed": 3,
        "timeOfSample": 123456789
    }
}

【Context No.50】
[similarity: 0.28229937]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoSweeperPlus",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        "onlineStatus": "online",
        "battery": 100,
        "timeOfSample": 123456789
    }
}

【Context No.51】
[similarity: 0.280316293]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "Strip Light 3",
        "deviceMac": DEVICE_MAC_ADDR,
        "powerState": "ON",//"ON"or"OFF"
        "brightness": 10,
        "color": "255:255:0",
        "colorTemperature": 3500,
        "timeOfSample": 123456789
    }
}

【Context No.52】
[similarity: 0.280177563]
{
    "statusCode": 100,
    "body": [
        {
            "url":url1,
            "createTime":123456,
            "lastUpdateTime":123456,
            "deviceList": "ALL",
            "enable":true
        }
    ],
    "message": ""
}

【Context No.53】
[similarity: 0.277866721]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoSweeper",
        "deviceMac": DEVICE_MAC_ADDR,
        "workingStatus"："StandBy",
        "onlineStatus": "online",
        "battery": 100,
        "timeOfSample": 123456789
    }
}

【Context No.54】
[similarity: 0.277484506]
POST /v1.1/scenes/{sceneId}/execute

【Context No.55】
[similarity: 0.277384967]
{
    "eventType": "changeReport",
    "eventVersion": "1",
    "context": {
        "deviceType": "WoCurtain",
        "deviceMac": DEVICE_MAC_ADDR,
        "calibrate":false,
        "group":false,
        "slidePosition":50, //0~100
        "battery":100,
        "timeOfSample": 123456789
    }
}
```

## Output Indicator
Ensure that, except for the parts modified to follow the latest specifications, the structure and format of the code remain identical to the original code. Here, "identical" means that there should be no differences (diff) whatsoever, including in indentation, spaces, line breaks, and code structure, which should all be exactly the same as the original.
If there are any changes beyond the modified sections, this is considered incorrect.
Also, verify that the modified code conforms to the latest specifications.